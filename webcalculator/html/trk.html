<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1"> <!--new-->
<head>
    <script type="text/javascript">
  // These variables are used by the web2py_ajax_init function in web2py_ajax.js (which is loaded below).
  var w2p_ajax_confirm_message = "Are you sure you want to delete this object?";
  var w2p_ajax_date_format = "%Y-%m-%d";
  var w2p_ajax_datetime_format = "%Y-%m-%d %H:%M:%S";
  //--></script>
    <title>TRK Regression Calculator</title>
    <script src="/rcr/static/js/jquery.js" type="text/javascript"></script>
    <link href="/rcr/static/css/calendar.css" rel="stylesheet" type="text/css" />
    <script src="/rcr/static/js/calendar.js" type="text/javascript"></script>
    <script src="/rcr/static/js/web2py.js" type="text/javascript"></script>
    <link href="/rcr/static/css/rcr2.css" rel="stylesheet" type="text/css" />
    <!--<link rel= "stylesheet" type= "text/css" href= "{{URL('static','css/rcr2.css')}}">-->
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:300' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-1.2.0.min.css" type="text/css" />
    <link rel="stylesheet" href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.2.0.min.css" type="text/css" />

    <!--<script href= "{{URL('static','js/jquery.js') }}" type="text/javascript"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.2.0.min.js"></script>
    <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.2.0.min.js"></script>
    <script type="text/javascript">
        Bokeh.set_log_level("info");
    </script>
</head>
<body>
    <!--////////////////////////////////////////////////////////////////////////////-->
    <!-- NAVIGATION BAR -->
    <!--////////////////////////////////////////////////////////////////////////////-->
    <div id="wrap">
        <ul class="navbar">
            <li style="margin-left:50px;"><a href="/rcr/calculator">Home</a> </li>
            <li><a href="/rcr/calculator/value">Single-Value RCR Calculator</a></li>
            <li><a href="/rcr/calculator/functional">Functional RCR Calculator</a></li>
            <li><a style="background-color:#5b8dd9;">TRK Regression Calculator</a></li>
            <li><a href="/rcr/calculator/downloads">Code and Downloads</a> </li>
            <li><a href="/rcr/calculator/contact">Contact Us</a> </li>
        </ul>
    </div>
    <!--////////////////////////////////////////////////////////////////////////////-->
    <!-- CALCULATOR -->
    <!--////////////////////////////////////////////////////////////////////////////-->
    <!--////////////////////////////////////////////////////////////////////////////-->
    <!-- DATA INPUT SECTION -->
    <!--////////////////////////////////////////////////////////////////////////////-->
    <div id="RMInput">
        <h1 style="font-size:3.5em;">TRK Regression Calculator</h1>
        <br>

        <i>Note: this page is a work in progress, to be published with our upcoming paper: Trotter, Reichart and Konz, 2020.</i>
        <br>
        <br>
        <h1 style="font-size:2.5em;">Input Data</h1>
        <div id="StepOne">
            <div id="ButtonSection">
                <h2> Select Data Type: </h2>
                <button id='Unweighted' class="Button DataType" onclick="noOutput()"> Equal Weights (Default) </button>
                <button id='Weighted' class="Button DataType" onclick="noOutput()"> Unequal Weights </button>
                <br>
                <br>

                <i style="padding-top:10px">Format: One data point per line: From left to right, list the independent (x) values followed by their error bars (uncertainties), then the dependent (y) values followed by their error bars, seperated by white space.</i>
                <br>
                <br>
                <i style="padding-top:10px">Weights, if unequal, should be included on the same line, furthest to the right, again separated by white space.</i>
                <br>
                <br>
            </div>
            <div id="RejectionMethod" style="padding-top:25px;  position:relative; float:right">
                <textarea class="dataTable" id="inputTextAreaData" style="height:250px"></textarea>
            </div>
        </div>

        <h1 style="font-size:2.5em;">Plot Data</h1>
        <div id="StepOne">
          <div id="Plot_input" style="padding: 25px; float: left;">
            <div class="bk-root" id="a4df8fe6-41b7-4e8f-a8ba-f9005769f2d6" data-root-id="1002"></div>
            
          
        
      
      
            <script type="application/json" id="1139">
              {"6d71a57a-8c84-4e61-8af2-06f4eac00824":{"roots":{"references":[{"attributes":{"callback":null},"id":"1007","type":"DataRange1d"},{"attributes":{},"id":"1011","type":"LinearScale"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1031","type":"Scatter"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1032","type":"Scatter"},"selection_glyph":null,"view":{"id":"1034","type":"CDSView"}},"id":"1033","type":"GlyphRenderer"},{"attributes":{"base":{"field":"x","units":"data"},"lower":{"field":"err_y_down","units":"data"},"lower_head":{"id":"1044","type":"TeeHead"},"source":{"id":"1001","type":"ColumnDataSource"},"upper":{"field":"err_y_up","units":"data"},"upper_head":{"id":"1043","type":"TeeHead"}},"id":"1035","type":"Whisker"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"units":"screen","value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1032","type":"Scatter"},{"attributes":{"axis_label":"y","formatter":{"id":"1047","type":"BasicTickFormatter"},"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1018","type":"LinearAxis"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1034","type":"CDSView"},{"attributes":{},"id":"1025","type":"ResetTool"},{"attributes":{"level":"underlay","size":10},"id":"1046","type":"TeeHead"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{"level":"underlay","size":10},"id":"1044","type":"TeeHead"},{"attributes":{"fill_alpha":{"value":0.6},"fill_color":{"value":"blue"},"line_alpha":{"value":0.6},"line_color":{"value":"blue"},"size":{"units":"screen","value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1031","type":"Scatter"},{"attributes":{"callback":null},"id":"1005","type":"DataRange1d"},{"attributes":{"args":{"p":{"id":"1002","subtype":"Figure","type":"Plot"},"srcData":{"id":"1001","type":"ColumnDataSource"},"xaxis":{"id":"1013","type":"LinearAxis"},"yaxis":{"id":"1018","type":"LinearAxis"}},"code":"\n    p.reset.emit();\n\n    let input_data = getData();\n\n    let x_data = input_data[0];\n    let err_x_data = input_data[1];\n    let y_data = input_data[2];\n    let err_y_data = input_data[3];\n\n    let x = [];\n    let err_x_up = [];\n    let err_x_down = [];\n    let y = []; \n    let err_y_up = [];\n    let err_y_down = [];\n    \n    var dataData = srcData.data;\n\n    dataData['x'] = [];\n    dataData['y'] = [];\n    dataData['err_x_up'] = [];\n    dataData['err_y_up'] = [];\n    dataData['err_x_down'] = [];\n    dataData['err_y_down'] = [];\n\n    x = dataData['x'];\n    y = dataData['y'];\n    err_x_up = dataData['err_x_up']\n    err_y_up = dataData['err_y_up']\n    err_x_down = dataData['err_x_down']\n    err_y_down = dataData['err_y_down']\n\n    for (let i = 0; i &lt; x_data.length; i++){\n        x[i] = x_data[i];\n        y[i] = y_data[i];\n        err_x_up[i] = x_data[i] + err_x_data[i];\n        err_y_up[i] = y_data[i] + err_y_data[i];\n        err_x_down[i] = x_data[i] - err_x_data[i];\n        err_y_down[i] = y_data[i] - err_y_data[i];\n    }\n\n    dataData['x'] = x;\n    dataData['y'] = y;\n    dataData['err_x_up'] = err_x_up;\n    dataData['err_y_up'] = err_y_up;\n    dataData['err_x_down'] = err_x_down;\n    dataData['err_y_down'] = err_y_down;\n\n    //xaxis.axis_label = playerPlotAxes[0];\n    //yaxis.axis_label = playerPlotAxes[1];\n\n    srcData.change.emit();   \n    p.change.emit();\n"},"id":"1039","type":"CustomJS"},{"attributes":{"base":{"field":"y","units":"data"},"dimension":"width","lower":{"field":"err_x_down","units":"data"},"lower_head":{"id":"1046","type":"TeeHead"},"source":{"id":"1001","type":"ColumnDataSource"},"upper":{"field":"err_x_up","units":"data"},"upper_head":{"id":"1045","type":"TeeHead"}},"id":"1037","type":"Whisker"},{"attributes":{"text":"Inputted Data"},"id":"1003","type":"Title"},{"attributes":{"level":"underlay","size":10},"id":"1045","type":"TeeHead"},{"attributes":{"axis_label":"x","formatter":{"id":"1041","type":"BasicTickFormatter"},"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1013","type":"LinearAxis"},{"attributes":{"level":"underlay","size":10},"id":"1043","type":"TeeHead"},{"attributes":{},"id":"1023","type":"PanTool"},{"attributes":{"dimension":1,"ticker":{"id":"1019","type":"BasicTicker"}},"id":"1022","type":"Grid"},{"attributes":{},"id":"1041","type":"BasicTickFormatter"},{"attributes":{},"id":"1047","type":"BasicTickFormatter"},{"attributes":{},"id":"1019","type":"BasicTicker"},{"attributes":{"ticker":{"id":"1014","type":"BasicTicker"}},"id":"1017","type":"Grid"},{"attributes":{},"id":"1024","type":"WheelZoomTool"},{"attributes":{},"id":"1049","type":"Selection"},{"attributes":{"background_fill_color":{"value":"#fafafa"},"below":[{"id":"1013","type":"LinearAxis"}],"center":[{"id":"1017","type":"Grid"},{"id":"1022","type":"Grid"},{"id":"1035","type":"Whisker"},{"id":"1037","type":"Whisker"}],"js_event_callbacks":{"mouseenter":[{"id":"1039","type":"CustomJS"}]},"left":[{"id":"1018","type":"LinearAxis"}],"min_border":10,"min_border_left":50,"plot_height":500,"plot_width":500,"renderers":[{"id":"1033","type":"GlyphRenderer"}],"title":{"id":"1003","type":"Title"},"toolbar":{"id":"1026","type":"Toolbar"},"toolbar_location":"above","x_range":{"id":"1005","type":"DataRange1d"},"x_scale":{"id":"1009","type":"LinearScale"},"y_range":{"id":"1007","type":"DataRange1d"},"y_scale":{"id":"1011","type":"LinearScale"}},"id":"1002","subtype":"Figure","type":"Plot"},{"attributes":{"active_drag":{"id":"1023","type":"PanTool"},"active_inspect":"auto","active_multi":null,"active_scroll":{"id":"1024","type":"WheelZoomTool"},"active_tap":"auto","tools":[{"id":"1023","type":"PanTool"},{"id":"1024","type":"WheelZoomTool"},{"id":"1025","type":"ResetTool"}]},"id":"1026","type":"Toolbar"},{"attributes":{},"id":"1050","type":"UnionRenderers"},{"attributes":{},"id":"1014","type":"BasicTicker"},{"attributes":{"callback":null,"data":{"err_x_down":[],"err_x_up":[],"err_y_down":[],"err_y_up":[],"x":[],"y":[]},"selected":{"id":"1049","type":"Selection"},"selection_policy":{"id":"1050","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"}],"root_ids":["1002"]},"title":"Input Data","version":"1.3.4"}}
            </script>
            <script type="text/javascript">
              (function() {
                var fn = function() {
                  Bokeh.safely(function() {
                    (function(root) {
                      function embed_document(root) {
                        
                      var docs_json = document.getElementById('1139').textContent;
                      var render_items = [{"docid":"6d71a57a-8c84-4e61-8af2-06f4eac00824","roots":{"1002":"a4df8fe6-41b7-4e8f-a8ba-f9005769f2d6"}}];
                      root.Bokeh.embed.embed_items(docs_json, render_items);
                    
                      }
                      if (root.Bokeh !== undefined) {
                        embed_document(root);
                      } else {
                        var attempts = 0;
                        var timer = setInterval(function(root) {
                          if (root.Bokeh !== undefined) {
                            embed_document(root);
                            clearInterval(timer);
                          }
                          attempts++;
                          if (attempts > 100) {
                            console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                            clearInterval(timer);
                          }
                        }, 10, root)
                      }
                    })(window);
                  });
                };
                if (document.readyState != "loading") fn();
                else document.addEventListener("DOMContentLoaded", fn);
              })();
            </script>
          </div>
          <div style="padding: 25px">
            <i style="padding-top:10px">Once the input data has been entered, plot it by mousing over the plot area. The plot can be panned over, and a zoom tool can be used by scrolling.</i>
            <br>
            <br>
            <i style="padding-top:10px">This can be used as a starting point to estimate the type of model to fit to the data.</i>
          </div>
        </div>
        <br>
        <div style="clear:both"></div>
        <h1 style="font-size:2.5em;">Model Data</h1>
        <div id="StepOne">
            <div>
                <div id="ButtonSection" style="float:left; width:30%; padding-right:10px">
                    <h2 id="ModelTitle">Model y(x):</h2>
                    <div>
                        <div class="dropdown">
                            <button id="SelectedFunction" class="dropbtn">(Select Function Here)</button>
                            <div class="dropdown-content" style="width:180%; overflow:visible;">
                                <button id="Linear" class="Button Function" onclick="displayChosenFunction(this); displayPivotSection(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>)</button>
                                <!-- <br>
                                <button id="Quadratic" class="Button Function" onclick="displayChosenFunction(this); displayPivotSection(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>) + a<sub>2</sub>(x-<span style="text-decoration:overline">x</span>)<sup>2</sup></button>
                                <br>
                                <button id="Cubic" class="Button Function" onclick="displayChosenFunction(this); displayPivotSection(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>) + a<sub>2</sub>(x-<span style="text-decoration:overline">x</span>)<sup>2</sup> + a<sub>3</sub>(x-<span style="text-decoration:overline">x</span>)<sup>3</sup></button>
                                <br>
                                <button id="PowerLaw" class="Button Function" onclick="displayChosenFunction(this); displayPivotSection(this);">y(x) = a<sub>0</sub>(x/10<sup><span style="text-decoration:overline">log<sub>10</sub>x</span></sup>)<sup>a<sub>1</sub></sup></button>
                                <br>
                                <button id="Exponential" class="Button Function" onclick="displayChosenFunction(this); displayPivotSection(this);">y(x) = a<sub>0</sub>10<sup>a<sub>1</sub>(x-<span style="text-decoration:overline">x</span>)</sup></button>
                                <br>
                                <button id="Logarithmic" class="Button Function" onclick="displayChosenFunction(this); display(this);">y(x) = a<sub>0</sub> + a<sub>1</sub>log<sub>10</sub>(x/10<sup><span style="text-decoration:overline">log<sub>10</sub>x</span></sup> )</button> -->
                            </div>
                        </div>
                        <br>
                        <br>
                        <i style="padding-top:10px">Here, select a function to model y(x). We currently only offer linear models on this online calculator, as due to the complex nature of the TRK algorithm, nonlinear models require too great a computational strength for a web calculator; in that case, we suggest deferring to the <a href="/rcr/calculator/downloads">source code</a>. Here, <span style="text-decoration:overline">x</span> is the "pivot point" of the model.</i>
                        <br>
                        <br>
                        <i style="padding-top:10px">In the box to the right, enter your guess for the model function parameters a<sub>0</sub> , a<sub>1</sub>, a<sub>2</sub> , etc. For example, in the linear model case, a<sub>0</sub> corresponds to the y-intercept, and a<sub>1</sub> to the slope. </i>
                        <br>
                        <br/>
                        <i style="padding-top:10px">Finally, enter guesses for the slop (extrinsic scatter of the data) along the x axis<br>and the y axis, as the last two lines (If unsure, guesses of about 1 are a safe bet) of this box.</i>
                        <br>
                        <br>
                        <i style="padding-top:10px">For large datasets and/or for non-listed custom functions, <br>it is recommended to use the C++ source code (documentation included) <a href="/rcr/calculator/downloads">here</a>.</i>
                        <br>
                        <br>

                        <!-- <i style="padding-top:10px">Here, select a function to model y(x). Currently  Depending on the chosen function, either <span style="text-decoration:overline">x</span> or <span style="text-decoration:overline">log<sub>10</sub> x</span> is the "pivot point" depending on which model function is selected. </i>
                        <br>
                        <br>
                        <i style="padding-top:10px">In the box to the right, enter your guess for the model function parameters a<sub>0</sub> , a<sub>1</sub> , a<sub>2</sub> , etc. For example, in the linear model case, a<sub>0</sub> corresponds to the y-intercept, and a<sub>1</sub> to the slope. </i>
                        <br>
                        <br/>
                        <i style="padding-top:10px">Finally, enter guesses for the slop (extrinsic scatter of the data) along the x axis<br>and the y axis, as the last two lines (If unsure, guesses of about 1 are a safe bet) of this box.</i>
                        <br>
                        <br>
                        <i style="padding-top:10px">For large datasets and/or for non-listed custom functions, <br>it is recommended to use the C++ source code (documentation included) <a href="/rcr/calculator/downloads">here</a>.</i>
                        <br>
                        <br> -->
                    </div>
                </div>
                <div id="RejectionMethod" style="float:left; width:30%; padding-right:10px">
                    <h2>Input Initial Guess for Model Function Parameters (Including Slop):</h2>
                    <br>
                    <textarea class="dataTable" id="guessarea" style="height:300px"></textarea>
                </div>
                <div id="pivotSection" style="float:left; width:30%"> 
                  <h2 >Determine Pivot Point of Model (Optional):</h2>
                  <div id="ButtonSection">
                    <button id='NoPivot' class="Button Pivot"> No (default) </button>
                    <button id='YesPivot' class="Button Pivot"> Yes </button>
                  </div>
                  <br>
                  <i style="padding-top:10px">If possible, by determining the pivot point of the model, the fitted model parameters can be made to be uncorrelated.</i>
                </div>
                <br style="clear: left;" />
                <br style="clear: left;" />
            </div>
            <br>
            <div>
                <!-- style="position:relative; display:block;"> -->
                <h2>Model Bayesian Prior Distributions of Model Function Parameters (Optional):</h2>
                <div style="width:45%; float:left; padding:5px;">
                    <div id="ButtonSection">
                        <button id='NoPriors' class="Button Priors" onclick="showPriorsBox(false);"> No (default) </button>
                        <button id='YesPriors' class="Button Priors" onclick="showPriorsBox(true);"> Yes </button>
                    </div>
                    <div id="priorsBox">
                        <div style="padding-top:10px; padding-bottom:20px; width:80%;">
                            <i>If you have some prior knowledge of the distribution(s) of your model function's parameters, this is where you can implement it.</i>
                            <br>
                            <br>
                            <i style="padding-top:10px">Format: One model parameter per line. For each line, list the lower bound for the parameter (or an "x" if there is none), followed by the upper bound (or an "x" if there is none), followed by the mean and the standard deviation of the Gaussian (or two "x"s in their place if the prior is flat), all seperated by white space.</i>
                            <br>
                            <br>
                            <i style="padding-top:10px">In total, each line will have four elements (either numbers or "x"s if no prior provided) seperated by white space. For example, a prior with lower bound of 0, no upper bound, and a Gaussian with ฮผ = 1, ฯ = 2 would have a line of "0 x 1 2".</i>
                            <br>
                            <br>
                            <i>For custom priors, use the source code (with documentation included).</i>
                        </div>
                        <div style="width:80%">
                            <img src="/rcr/static/priorspic.png">
                        </div>
                        <div style="padding-top:10px; padding-bottom:20px; width:80%;">
                            <i>Pictured is a Gaussian prior distribution with ฮผ = 1, ฯ = 2, and an upper bound of 3.</i>
                        </div>
                    </div>
                </div>
                <div id="priorsInput" style="padding:5px; width:45%; float:left;">
                    <h2>Input Priors:</h2>
                    <textarea class="dataTable" id="priorsArea" style="height:150px"></textarea>
                </div>
            </div>

        </div>
        <br>
        <div style="clear:both"></div>
        <h1 style="font-size:2.5em; padding-top:25px;">Select Fitting Algorithm</h1>
        <!--////////////////////////////////////////////////////////////////////////////-->
        <!-- DISTRIBUTION SELECTION -->
        <!--////////////////////////////////////////////////////////////////////////////-->
        <div id="StepOne" style="overflow:auto">

            <div id="ButtonSection">

                <h2>Optimize Fitting Scale?</h2>

                <button id="OpScale" class="Button Distribution">Yes (Default)</button>
                <button id="NoOpScale" class="Button Distribution">No</button>
                <br>
                <div id="selectScale">
                Select scale: (1.0 by default): <textarea class="dataTable" id="scaleArea" style="height:20px; width:70%;float: left;"></textarea>
                </div>
                <br>
                <h2 id="SelectContaminantSectionTitle">Generate Model Parameter Distributions/Uncertainties?</h2>
                <div id="SelectContaminantSection">
                    <button id="YesMCMC" class="Button Contaminants">Yes</button>
                    <button id="NoMCMC" class="Button Contaminants">No (Default)</button>
                </div>
            </div>
            <div id="RejectionMethod">

                <h2> Selected Fitting Algorithm: </h2>
                <br>
                <div style="width:80%">
                    <img style="width:auto; height:100px" src="/rcr/static/YesScaleYesMCMC.png" id="YesScaleYesMCMC">
                    <img style="width:auto; height:100px" src="/rcr/static/YesScaleNoMCMC.png" id="YesScaleNoMCMC">
                    <img style="width:auto; height:100px" src="/rcr/static/NoScaleYesMCMC.png" id="NoScaleYesMCMC">
                    <img style="width:auto; height:100px" src="/rcr/static/NoScaleNoMCMC.png" id="NoScaleNoMCMC">
                </div>
                <div style="padding:10px">
                  <ol id="Option11" class="RejectionMethods">
                    <li>Optimize fitting scale using TRK correlation coefficient (ยง2.5.1, Trotter et al., in preparation)</li>
                    <li>Find best fit at this scale by maximizing TRK Likelihood with downhill simplex method (ยง2.5.1)</li>
                    <li>Generate model parameter distributions using Adaptive Markov Chain Monte Carlo sampler (ยง2.5.2)</li>
                  </ol>  
                  <ol id="Option10" class="RejectionMethods">
                    <li>Optimizate fitting scale using TRK correlation coefficient (ยง2.5.1, Trotter et al., in preparation)</li>
                    <li>Find best fit at this scale by maximizing TRK Likelihood with downhill simplex method (ยง2.5.1)</li>
                  </ol>  
                  <ol id="Option01" class="RejectionMethods">
                      <li>Find best fit at chosen scale by maximizing TRK Likelihood with downhill simplex method (ยง2.5.1, Trotter et al., in preparation)</li>
                      <li>Generate model parameter distributions using Adaptive Markov Chain Monte Carlo sampler (ยง2.5.2)</li>
                  </ol>  
                  <ol id="Option00" class="RejectionMethods">
                      <li>Find best fit at chosen scale by maximizing TRK Likelihood with downhill simplex method (ยง2.5.1, Trotter et al., in preparation)</li>
                  </ol>
                  <p id="OptionAll" class="RejectionMethods">
                      <!-- (this displays for all options selected) -->
                  </p>
                </div>

            </div>
        </div>

        <!--////////////////////////////////////////////////////////////////////////////-->
        <!-- DATA OUTPUT SECTION -->
        <!--////////////////////////////////////////////////////////////////////////////-->

        <h1 style="font-size:2.5em; padding-top:25px;">Perform Fit</h1>
        <div id="StepOne">
          <div>
            <div id="Results" style="float:left; width:40%; padding-right:25px">
                <br>
                <div style="float:left; width:400px">
                    <button id="PerformTRK" class="Button RejectButton" onclick="performTRK();">Perform Fit!</button>
                </div>
                <br>
                <div id="OutputTableWrapper">

                    <div id="RejectionMethod" style="width:130%; float:right">
                        <table style="float:right">
                            <tr>
                                <th>Final model<br>parameters<br>(including slop)</th>
                                <th>Optimum, minimum <br> and maximum scales</th>
                            </tr>
                            <tr>
                                <th><textarea class="dataTable" id="finalParameters" style="margin-top:10px; width:80%; height:200px"></textarea></th>
                                <th><textarea class="dataTable" id="scales" style="margin-top:10px; width:80%; height:200px"></textarea></th>
                            </tr>

                        </table>
                        <div style="clear:both"></div>
                        <table style="float:right">
                            <tr>
                                <th>Parameter uncertainties:<br>(- 1 2 3, + 1 2 3 ฯ) </th>
                            </tr>
                            <tr>
                                <th><textarea class="dataTable" id="parameterSigmas" style="margin-top:10px; width:180%; height:200px"></textarea></th>
                            </tr>

                        </table>
                    </div>
                </div>
            </div>
            <div id="OutputPlot" style="float:left; width:50%">
              <h2>Plot of Fitted Model</h2>
              <br>
              <i style="padding-top:10px">Shaded regions indicate the 1-, 2- and 3ฯslop envelopes of the model distribution.</i>
              <br>
              <div class="bk-root" id="a5c6a122-8c4b-4caa-baf8-996ebe9f2c64" data-root-id="1003"></div>
              <script type="application/json" id="1169">
                {"ab71f052-1274-48a6-9cec-d9acd25f1298":{"roots":{"references":[{"attributes":{"ticker":{"id":"1015","type":"BasicTicker"}},"id":"1018","type":"Grid"},{"attributes":{"callback":null,"data":{"lower1":[],"lower2":[],"lower3":[],"upper1":[],"upper2":[],"upper3":[],"x_m":[],"y_m":[]},"selected":{"id":"1064","type":"Selection"},"selection_policy":{"id":"1063","type":"UnionRenderers"}},"id":"1002","type":"ColumnDataSource"},{"attributes":{},"id":"1020","type":"BasicTicker"},{"attributes":{"axis_label":"x","formatter":{"id":"1053","type":"BasicTickFormatter"},"ticker":{"id":"1015","type":"BasicTicker"}},"id":"1014","type":"LinearAxis"},{"attributes":{"dimension":1,"ticker":{"id":"1020","type":"BasicTicker"}},"id":"1023","type":"Grid"},{"attributes":{"base":{"field":"x_m","units":"data"},"fill_alpha":{"value":0.1},"fill_color":{"value":"blue"},"level":"underlay","line_color":{"value":"black"},"line_width":{"value":2},"lower":{"field":"lower3","units":"data"},"source":{"id":"1002","type":"ColumnDataSource"},"upper":{"field":"upper3","units":"data"}},"id":"1049","type":"Band"},{"attributes":{},"id":"1053","type":"BasicTickFormatter"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1032","type":"Scatter"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1033","type":"Scatter"},"selection_glyph":null,"view":{"id":"1035","type":"CDSView"}},"id":"1034","type":"GlyphRenderer"},{"attributes":{"base":{"field":"x","units":"data"},"lower":{"field":"err_y_down","units":"data"},"lower_head":{"id":"1057","type":"TeeHead"},"source":{"id":"1001","type":"ColumnDataSource"},"upper":{"field":"err_y_up","units":"data"},"upper_head":{"id":"1058","type":"TeeHead"}},"id":"1036","type":"Whisker"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1035","type":"CDSView"},{"attributes":{"level":"underlay","size":10},"id":"1058","type":"TeeHead"},{"attributes":{"level":"underlay","size":10},"id":"1059","type":"TeeHead"},{"attributes":{"fill_color":{"value":"red"},"line_color":{"value":"red"},"size":{"units":"screen","value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1032","type":"Scatter"},{"attributes":{},"id":"1010","type":"LinearScale"},{"attributes":{"level":"underlay","size":10},"id":"1060","type":"TeeHead"},{"attributes":{},"id":"1061","type":"UnionRenderers"},{"attributes":{},"id":"1062","type":"Selection"},{"attributes":{"line_alpha":0.6,"line_width":3,"x":{"field":"x_m"},"y":{"field":"y_m"}},"id":"1041","type":"Line"},{"attributes":{"base":{"field":"y","units":"data"},"dimension":"width","lower":{"field":"err_x_down","units":"data"},"lower_head":{"id":"1059","type":"TeeHead"},"source":{"id":"1001","type":"ColumnDataSource"},"upper":{"field":"err_x_up","units":"data"},"upper_head":{"id":"1060","type":"TeeHead"}},"id":"1038","type":"Whisker"},{"attributes":{},"id":"1063","type":"UnionRenderers"},{"attributes":{"callback":null},"id":"1008","type":"DataRange1d"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","line_width":3,"x":{"field":"x_m"},"y":{"field":"y_m"}},"id":"1042","type":"Line"},{"attributes":{},"id":"1064","type":"Selection"},{"attributes":{"callback":null},"id":"1006","type":"DataRange1d"},{"attributes":{"background_fill_color":{"value":"#fafafa"},"below":[{"id":"1014","type":"LinearAxis"}],"center":[{"id":"1018","type":"Grid"},{"id":"1023","type":"Grid"},{"id":"1036","type":"Whisker"},{"id":"1038","type":"Whisker"},{"id":"1045","type":"Band"},{"id":"1047","type":"Band"},{"id":"1049","type":"Band"}],"js_event_callbacks":{"mouseenter":[{"id":"1051","type":"CustomJS"}]},"left":[{"id":"1019","type":"LinearAxis"}],"min_border":10,"min_border_left":50,"renderers":[{"id":"1034","type":"GlyphRenderer"},{"id":"1043","type":"GlyphRenderer"}],"title":{"id":"1004","type":"Title"},"toolbar":{"id":"1027","type":"Toolbar"},"toolbar_location":"above","x_range":{"id":"1006","type":"DataRange1d"},"x_scale":{"id":"1010","type":"LinearScale"},"y_range":{"id":"1008","type":"DataRange1d"},"y_scale":{"id":"1012","type":"LinearScale"}},"id":"1003","subtype":"Figure","type":"Plot"},{"attributes":{"base":{"field":"x_m","units":"data"},"fill_alpha":{"value":0.3},"fill_color":{"value":"blue"},"level":"underlay","line_color":{"value":"black"},"line_width":{"value":2},"lower":{"field":"lower1","units":"data"},"source":{"id":"1002","type":"ColumnDataSource"},"upper":{"field":"upper1","units":"data"}},"id":"1045","type":"Band"},{"attributes":{"level":"underlay","size":10},"id":"1057","type":"TeeHead"},{"attributes":{},"id":"1012","type":"LinearScale"},{"attributes":{"data_source":{"id":"1002","type":"ColumnDataSource"},"glyph":{"id":"1041","type":"Line"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1042","type":"Line"},"selection_glyph":null,"view":{"id":"1044","type":"CDSView"}},"id":"1043","type":"GlyphRenderer"},{"attributes":{"active_drag":{"id":"1024","type":"PanTool"},"active_inspect":"auto","active_multi":null,"active_scroll":{"id":"1025","type":"WheelZoomTool"},"active_tap":"auto","tools":[{"id":"1024","type":"PanTool"},{"id":"1025","type":"WheelZoomTool"},{"id":"1026","type":"ResetTool"}]},"id":"1027","type":"Toolbar"},{"attributes":{"args":{"p":{"id":"1003","subtype":"Figure","type":"Plot"},"srcData":{"id":"1001","type":"ColumnDataSource"},"srcModel":{"id":"1002","type":"ColumnDataSource"},"xaxis":{"id":"1014","type":"LinearAxis"},"yaxis":{"id":"1019","type":"LinearAxis"}},"code":"\n    p.reset.emit();\n\n    let input_data = getData();\n    let model_plot = getModelData();\n\n    let x_data = input_data[0];\n    let err_x_data = input_data[1];\n    let y_data = input_data[2];\n    let err_y_data = input_data[3];\n\n    let x_m_data = model_plot[0];\n    let y_m_data = model_plot[1];\n    let prams = model_plot[3];\n\n    let x = [];\n    let err_x_up = [];\n    let err_x_down = [];\n    let y = []; \n    let err_y_up = [];\n    let err_y_down = [];\n\n    let x_m = [];\n    let y_m = [];\n    let lower1 = [];\n    let lower2 = [];\n    let lower3 = [];\n    let upper1 = [];\n    let upper2 = [];\n    let upper3 = [];\n    \n    var dataData = srcData.data;\n    var dataModel = srcModel.data;\n\n    dataData['x'] = [];\n    dataData['y'] = [];\n    dataData['err_x_up'] = [];\n    dataData['err_y_up'] = [];\n    dataData['err_x_down'] = [];\n    dataData['err_y_down'] = [];\n\n    dataModel['x_m'] = [];\n    dataModel['y_m'] = [];\n    dataModel['lower1'] = [];\n    dataModel['lower2'] = [];\n    dataModel['lower3'] = [];\n    dataModel['upper1'] = [];\n    dataModel['upper2'] = [];\n    dataModel['upper3'] = [];\n\n    x = dataData['x'];\n    y = dataData['y'];\n    err_x_up = dataData['err_x_up']\n    err_y_up = dataData['err_y_up']\n    err_x_down = dataData['err_x_down']\n    err_y_down = dataData['err_y_down']\n    \n    x_m = dataModel['x_m'];\n    y_m = dataModel['y_m'];\n    lower1 = dataModel['lower1'];\n    lower2 = dataModel['lower2'];\n    lower3 = dataModel['lower3'];\n    upper1 = dataModel['upper1'];\n    upper2 = dataModel['upper2'];\n    upper3 = dataModel['upper3'];\n\n    let bands = getBands(x_m_data, y_m_data, prams);\n\n    for (let i = 0; i &lt; x_data.length; i++){\n        x[i] = x_data[i];\n        y[i] = y_data[i];\n        err_x_up[i] = x_data[i] + err_x_data[i];\n        err_y_up[i] = y_data[i] + err_y_data[i];\n        err_x_down[i] = x_data[i] - err_x_data[i];\n        err_y_down[i] = y_data[i] - err_y_data[i];\n    }\n\n    for (let i = 0; i &lt; x_m_data.length; i++){\n        x_m[i] = x_m_data[i];\n        y_m[i] = y_m_data[i];\n\n        lower1[i] = bands[0][i];\n        lower2[i] = bands[1][i];\n        lower3[i] = bands[2][i];\n        upper1[i] = bands[3][i];\n        upper2[i] = bands[4][i];\n        upper3[i] = bands[5][i];\n    }\n\n    dataData['x'] = x;\n    dataData['y'] = y;\n    dataData['err_x_up'] = err_x_up;\n    dataData['err_y_up'] = err_y_up;\n    dataData['err_x_down'] = err_x_down;\n    dataData['err_y_down'] = err_y_down;\n\n    dataModel['x_m'] = x_m;\n    dataModel['y_m'] = y_m;\n    dataModel['lower1'] = lower1;\n    dataModel['lower2'] = lower2;\n    dataModel['lower3'] = lower3;\n    dataModel['upper1'] = upper1;\n    dataModel['upper2'] = upper2;\n    dataModel['upper3'] = upper3;\n\n    //console.log(lower1)\n    //console.log(lower2)\n    //console.log(lower3)\n    //console.log(upper1)\n    //console.log(upper2)\n    //console.log(upper3)\n\n    srcData.change.emit();  \n    srcModel.change.emit(); \n    p.change.emit();\n"},"id":"1051","type":"CustomJS"},{"attributes":{"source":{"id":"1002","type":"ColumnDataSource"}},"id":"1044","type":"CDSView"},{"attributes":{"text":"Fitted Model"},"id":"1004","type":"Title"},{"attributes":{},"id":"1024","type":"PanTool"},{"attributes":{},"id":"1025","type":"WheelZoomTool"},{"attributes":{},"id":"1055","type":"BasicTickFormatter"},{"attributes":{"base":{"field":"x_m","units":"data"},"fill_alpha":{"value":0.2},"fill_color":{"value":"blue"},"level":"underlay","line_color":{"value":"black"},"line_width":{"value":2},"lower":{"field":"lower2","units":"data"},"source":{"id":"1002","type":"ColumnDataSource"},"upper":{"field":"upper2","units":"data"}},"id":"1047","type":"Band"},{"attributes":{},"id":"1026","type":"ResetTool"},{"attributes":{},"id":"1015","type":"BasicTicker"},{"attributes":{"callback":null,"data":{"err_x_down":[],"err_x_up":[],"err_y_down":[],"err_y_up":[],"x":[],"y":[]},"selected":{"id":"1062","type":"Selection"},"selection_policy":{"id":"1061","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"},{"attributes":{"axis_label":"y","formatter":{"id":"1055","type":"BasicTickFormatter"},"ticker":{"id":"1020","type":"BasicTicker"}},"id":"1019","type":"LinearAxis"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"size":{"units":"screen","value":10},"x":{"field":"x"},"y":{"field":"y"}},"id":"1033","type":"Scatter"}],"root_ids":["1003"]},"title":"Fitted Model","version":"1.3.4"}}
              </script>
              <script type="text/javascript">
                (function() {
                  var fn = function() {
                    Bokeh.safely(function() {
                      (function(root) {
                        function embed_document(root) {
                          
                        var docs_json = document.getElementById('1169').textContent;
                        var render_items = [{"docid":"ab71f052-1274-48a6-9cec-d9acd25f1298","roots":{"1003":"a5c6a122-8c4b-4caa-baf8-996ebe9f2c64"}}];
                        root.Bokeh.embed.embed_items(docs_json, render_items);
                      
                        }
                        if (root.Bokeh !== undefined) {
                          embed_document(root);
                        } else {
                          var attempts = 0;
                          var timer = setInterval(function(root) {
                            if (root.Bokeh !== undefined) {
                              embed_document(root);
                              clearInterval(timer);
                            }
                            attempts++;
                            if (attempts > 100) {
                              console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                              clearInterval(timer);
                            }
                          }, 10, root)
                        }
                      })(window);
                    });
                  };
                  if (document.readyState != "loading") fn();
                  else document.addEventListener("DOMContentLoaded", fn);
                })();
              </script>
            </div>
          <br style="clear: left;" />
          <br style="clear: left;" />
          </div>
          <br>
          <div id="Histogram">
            <h2>Plot of Model Parameter Distributions</h2>
            <br>
            <i style="padding-top:10px">Expore the MCMC-generated probability distributions of the model parameters. Use the dropdown menu at the top left to select which parameter to display.</i>
            <br>
            <div style="float:left; width:50%">
              <div class="bk-root" id="8612bb93-d226-4b4e-a4b4-9a5411cfbf97" data-root-id="1036"></div>
            
          
        
      
      
              <script type="application/json" id="1174">
                {"22211530-5d9e-46c7-8aed-4b4949cace4b":{"roots":{"references":[{"attributes":{"axis_label":"probability","formatter":{"id":"1040","type":"BasicTickFormatter"},"major_label_text_font_size":{"value":"0pt"},"major_tick_line_color":{"value":null},"minor_tick_line_color":{"value":null},"ticker":{"id":"1017","type":"BasicTicker"}},"id":"1016","type":"LinearAxis"},{"attributes":{"code":"\n    let val = this.value;\n    whichParam = Number(val.slice(-1));\n"},"id":"1032","type":"CustomJS"},{"attributes":{"callback":null,"data":{"arr_hist":[],"left":[],"right":[]},"selected":{"id":"1044","type":"Selection"},"selection_policy":{"id":"1043","type":"UnionRenderers"}},"id":"1001","type":"ColumnDataSource"},{"attributes":{"source":{"id":"1001","type":"ColumnDataSource"}},"id":"1030","type":"CDSView"},{"attributes":{"axis_label":"parameter","formatter":{"id":"1042","type":"BasicTickFormatter"},"ticker":{"id":"1012","type":"BasicTicker"}},"id":"1011","type":"LinearAxis"},{"attributes":{},"id":"1044","type":"Selection"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{},"id":"1040","type":"BasicTickFormatter"},{"attributes":{"data_source":{"id":"1001","type":"ColumnDataSource"},"glyph":{"id":"1027","type":"Quad"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1028","type":"Quad"},"selection_glyph":null,"view":{"id":"1030","type":"CDSView"}},"id":"1029","type":"GlyphRenderer"},{"attributes":{"dimension":1,"ticker":{"id":"1017","type":"BasicTicker"}},"id":"1020","type":"Grid"},{"attributes":{"args":{"axis":{"id":"1011","type":"LinearAxis"},"p":{"id":"1002","subtype":"Figure","type":"Plot"},"src":{"id":"1001","type":"ColumnDataSource"},"x_range":{"id":"1003","type":"Range1d"}},"code":"\n\n    p.reset.emit();\n\n\n    var hist_result = paramHistograms[whichParam];\n\n    var arr_hist_result = hist_result[0];\n    var left_result = hist_result[1].slice(0,-1);\n    var right_result = hist_result[1].slice(1);\n\n    let bincount = arr_hist_result.length;\n\n    var data = src.data;\n\n    var arr_hist = [];\n    var left = [];\n    var right = [];\n\n    data['arr_hist'] = [];\n    data['left'] = [];\n    data['right'] = [];\n\n    arr_hist = data['arr_hist'];\n    left = data['left'];\n    right = data['right'];\n\n    for (var i = 0; i &lt; bincount; i++){\n        arr_hist[i] = arr_hist_result[i];\n        left[i] = left_result[i];\n        right[i] = right_result[i];\n    }\n\n    data['arr_hist'] = arr_hist;\n    data['left'] = left;\n    data['right'] = right;\n\n    x_range.start = left[0];\n    x_range.end = right[bincount-1];\n\n    p.change.emit();\n    src.change.emit();\n\n"},"id":"1031","type":"CustomJS"},{"attributes":{},"id":"1017","type":"BasicTicker"},{"attributes":{},"id":"1012","type":"BasicTicker"},{"attributes":{"callback":null},"id":"1005","type":"DataRange1d"},{"attributes":{"ticker":{"id":"1012","type":"BasicTicker"}},"id":"1015","type":"Grid"},{"attributes":{"callback":null},"id":"1003","type":"Range1d"},{"attributes":{"callback":null,"js_event_callbacks":{"mouseenter":[{"id":"1034","type":"CustomJS"}]},"js_property_callbacks":{"change:value":[{"id":"1032","type":"CustomJS"},{"id":"1031","type":"CustomJS"}]},"options":[],"title":"Select Model Parameter"},"id":"1033","type":"Select"},{"attributes":{"dimensions":"width"},"id":"1021","type":"PanTool"},{"attributes":{},"id":"1043","type":"UnionRenderers"},{"attributes":{"below":[{"id":"1011","type":"LinearAxis"}],"center":[{"id":"1015","type":"Grid"},{"id":"1020","type":"Grid"}],"js_event_callbacks":{"mouseenter":[{"id":"1034","type":"CustomJS"},{"id":"1031","type":"CustomJS"}]},"left":[{"id":"1016","type":"LinearAxis"}],"plot_height":400,"plot_width":500,"renderers":[{"id":"1029","type":"GlyphRenderer"}],"title":{"id":"1038","type":"Title"},"toolbar":{"id":"1023","type":"Toolbar"},"x_range":{"id":"1003","type":"Range1d"},"x_scale":{"id":"1007","type":"LinearScale"},"y_range":{"id":"1005","type":"DataRange1d"},"y_scale":{"id":"1009","type":"LinearScale"}},"id":"1002","subtype":"Figure","type":"Plot"},{"attributes":{"text":""},"id":"1038","type":"Title"},{"attributes":{"dimensions":"width"},"id":"1022","type":"WheelZoomTool"},{"attributes":{"bottom":{"value":0},"fill_alpha":{"value":0.1},"fill_color":{"value":"#1f77b4"},"left":{"field":"left"},"line_alpha":{"value":0.1},"line_color":{"value":"#1f77b4"},"right":{"field":"right"},"top":{"field":"arr_hist"}},"id":"1028","type":"Quad"},{"attributes":{"bottom":{"value":0},"fill_color":{"value":"cornflowerblue"},"left":{"field":"left"},"right":{"field":"right"},"top":{"field":"arr_hist"}},"id":"1027","type":"Quad"},{"attributes":{"children":[{"id":"1035","type":"Row"},{"id":"1002","subtype":"Figure","type":"Plot"}]},"id":"1036","type":"Column"},{"attributes":{"active_drag":{"id":"1021","type":"PanTool"},"active_inspect":"auto","active_multi":null,"active_scroll":{"id":"1022","type":"WheelZoomTool"},"active_tap":"auto","tools":[{"id":"1021","type":"PanTool"},{"id":"1022","type":"WheelZoomTool"}]},"id":"1023","type":"Toolbar"},{"attributes":{"args":{"select":{"id":"1033","type":"Select"}},"code":"\n    let options = [];\n    for (let m = 0; m &lt; parameters.length - 2; m++){ //excluding slop\n        options.push(\"a\" + m.toString());\n    }\n    select.options = options;\n"},"id":"1034","type":"CustomJS"},{"attributes":{},"id":"1007","type":"LinearScale"},{"attributes":{},"id":"1042","type":"BasicTickFormatter"},{"attributes":{"children":[{"id":"1033","type":"Select"}]},"id":"1035","type":"Row"}],"root_ids":["1036"]},"title":"Histogram of Parameter Distributions","version":"1.3.4"}}
              </script>
              <script type="text/javascript">
                (function() {
                  var fn = function() {
                    Bokeh.safely(function() {
                      (function(root) {
                        function embed_document(root) {
                          
                        var docs_json = document.getElementById('1174').textContent;
                        var render_items = [{"docid":"22211530-5d9e-46c7-8aed-4b4949cace4b","roots":{"1036":"8612bb93-d226-4b4e-a4b4-9a5411cfbf97"}}];
                        root.Bokeh.embed.embed_items(docs_json, render_items);
                      
                        }
                        if (root.Bokeh !== undefined) {
                          embed_document(root);
                        } else {
                          var attempts = 0;
                          var timer = setInterval(function(root) {
                            if (root.Bokeh !== undefined) {
                              embed_document(root);
                              clearInterval(timer);
                            }
                            attempts++;
                            if (attempts > 100) {
                              console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                              clearInterval(timer);
                            }
                          }, 10, root)
                        }
                      })(window);
                    });
                  };
                  if (document.readyState != "loading") fn();
                  else document.addEventListener("DOMContentLoaded", fn);
                })();
              </script>
            </div>
            <div style="padding: 25px">
            </div>
          </div>
        </div>
        <div style="clear:both"></div>

    </div>
</body>
</html>
<script>
    var chosenFunctionType;

//Initializing the final result lists that will come from RCR and will result in plotting:
    var parameters = []; //including slop
    var bestFit_123Sigmas = []; //3-tensor; matches cpp implementation
    var pivot = 0; //will come from cpp code. 0 by default.
    var paramHistograms = []; //organized same as paramDistributionHistograms in cpp
    var whichParam = 0; //index  of param being plotted in hist

    var x_basis = 'linear';
    var y_basis = 'linear';

    var doScale = false;
    var doMCMC = false;

    // MODEL FUNCTIONS

    function linear(x, params, bar){
      var a0 = params[0];
	    var a1 = params[1];

	    return a0 + a1 * (x - bar);
    }

    function quadratic(x, params, bar){
      var a0 = params[0];
	    var a1 = params[1];
      var a2 = params[2];

	    return a0 + a1 * (x - bar) + a2 * Math.pow((x - bar), 2.0);
    }

    function cubic(x, params, bar){
      var a0 = params[0];
	    var a1 = params[1];
      var a2 = params[2];
      var a3 = params[3];

	    return a0 + a1 * (x - bar) + a2 * Math.pow((x - bar), 2.0) + a3 * Math.pow((x - bar), 3.0);
    }

    function powerlaw(x, params, bar){
      var a0 = params[0];
	    var a1 = params[1];

	    return a0 * Math.pow((x / Math.pow(10, bar)), a1);
    }

    function exponential(x, params, bar){
      var a0 = params[0];
	    var a1 = params[1];

	    return a0 * Math.pow(10, a1*(x - bar));
    }

    function logarithmic(x, params, bar){
      var a0 = params[0];
      var a1 = params[1];

	    return a0 + a1*Math.log10(x/bar);
    }



    // MODEL FUNCTION DERIVATIVES

    function dLinear(x, params, bar){
      var a1 = params[1];

      return a1;
    }

    function dQuadratic(x, params, bar){
      var a1 = params[1];
      var a2 = params[2];

      return a1 + 2.0 * a2 * (x);
    }

    function dCubic(x, params, bar){
      var a1 = params[1];
      var a2 = params[2];
      var a3 = params[3];

      return a1 + 2.0 * a2 * (x) + 3.0 * a3 * Math.pow((x), 2.0);
    }

    function dPowerLaw(x, params, bar){
      var a0 = params[0];
      var a1 = params[1];

      return Math.pow(10.0, -1.0*bar) * a0 * a1 * Math.pow(Math.pow(10.0, -bar) * x, a1 - 1.0);
    }

    function dExponential(x, params, bar){
      var a0 = params[0];
      var a1 = params[1];

      return Math.pow(10, a1*(x - bar)) * a0 * a1 * Math.log(10.0);
    }

    function dLogarithmic(x, params, bar){
      var a1 = params[1];

      return a1 / (x*Math.log(10.0));
    }

    function noOutput(){
	    $('#OutputTableWrapper').css('display', 'none');
	    //$('#OverRejectionNote').css('display', 'none');
    }

    function test(){
      console.log('Testing performFunctionalRCR button')
      return;
    }

    function testCallBegin(){
	    console.log('Callback begins');
	    return;
    }

    function testCallEnd(){
	    console.log('Callback ends');
	    return;
    }

    function testLog(thing){
	    console.log(thing);
	    return;
    }

    function changeFunctionDisplay(oldy_basis){
      var buttonNames = document.getElementsByClassName('Button DataType Function');
      switch (oldy_basis){
        case 'linear':
          switch (y_basis){
            case 'linear':
              break;
            case 'log':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "log y(x) = ";
                newName += buttonNames[i].innerHTML.slice(7, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            case 'exp':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "10<sup>y(x)</sup> = ";
                newName += buttonNames[i].innerHTML.slice(7, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            default:
              break;
          }
          break;
        case 'log':
          switch (y_basis){
            case 'linear':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "y(x) = ";
                newName += buttonNames[i].innerHTML.slice(11, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            case 'log':
              break;
            case 'exp':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "10<sup>y(x)</sup> = ";
                newName += buttonNames[i].innerHTML.slice(11, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            default:
              break;
          }
          break;
        case 'exp':
          switch (y_basis){
            case 'linear':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "y(x) = ";
                newName += buttonNames[i].innerHTML.slice(20, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            case 'log':
              for (var i = 0; i < buttonNames.length; i++){
                var newName = "log y(x) = ";
                newName += buttonNames[i].innerHTML.slice(20, -1);
                buttonNames[i].innerHTML = newName;
              }
              break;
            case 'exp':
              break;
            default:
              break;
          }
          break;
        default:
          break;
      }
    }

    function transformXLinear(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_y = [];

	    for (var i = 0; i < x_data.length; i++){
		    if (x_data[i] > 0){
			    trans_x.push(x_data[i]);
          switch (y_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_y.push(y_data[i]);
              break;
            case 'log':
              if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_x.pop();
              } else {
                new_y.push(Math.log10(y_data[i]));
              }
            case 'exp':
              new_y.push(Math.pow(10,y_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      x_basis = 'linear';
	    return [trans_x, new_y];
    }

    function transformYLinear(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_x = [];

	    for (var i = 0; i < y_data.length; i++){
		    if (y_data[i] > 0){
			    trans_y.push(y_data[i]);
          switch (x_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_x.push(x_data[i]);
              break;
            case 'log':
              if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_y.pop();
              } else {
                new_x.push(Math.log10(x_data[i]));
              }
            case 'exp':
              new_x.push(Math.pow(10,x_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      y_basis = 'linear';
	    return [new_x, trans_y];
    }

    function transformXExp(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_y = [];

	    for (var i = 0; i < x_data.length; i++){
		    if (x_data[i] > 0){
			    trans_x.push(Math.pow(10,x_data[i]));
          switch (y_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_y.push(y_data[i]);
              break;
            case 'log':
              if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_x.pop();
              } else {
                new_y.push(Math.log10(y_data[i]));
              }
            case 'exp':
              new_y.push(Math.pow(10,y_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      x_basis = 'exp';
	    return [trans_x, new_y];
    }

    function transformYExp(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_x = [];

	    for (var i = 0; i < y_data.length; i++){
		    if (y_data[i] > 0){
			    trans_y.push(Math.pow(10,y_data[i]));
          switch (x_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_x.push(x_data[i]);
              break;
            case 'log':
              if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_y.pop();
              } else {
                new_x.push(Math.log10(x_data[i]));
              }
            case 'exp':
              new_x.push(Math.pow(10,x_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      y_basis = 'exp';
	    return [new_x, trans_y];
    }

    function transformXLog(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_x = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_y = [];

	    for (var i = 0; i < x_data.length; i++){
		    if (x_data[i] > 0){
			    trans_x.push(Math.log10(x_data[i]));
          switch (y_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_y.push(y_data[i]);
              break;
            case 'log':
              if (y_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_x.pop();
              } else {
                new_y.push(Math.log10(y_data[i]));
              }
            case 'exp':
              new_y.push(Math.pow(10,y_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      x_basis = 'log';
	    return [trans_x, new_y];
    }

    function transformYLog(x_data, y_data){ //takes in RAW DATA for x and y, always
	    var trans_y = []; //if one axis is transformed to log, negative points will be rejected; the corresponded points in the other dimension must also be removed.
      var new_x = [];

	    for (var i = 0; i < y_data.length; i++){
		    if (y_data[i] > 0){
			    trans_y.push(Math.log10(y_data[i]));
          switch (x_basis){
            case 'linear': //whichever basis the non-transformed axis is in needs to be maintained
              new_x.push(x_data[i]);
              break;
            case 'log':
              if (x_data[i] <= 0){ //if the other variable is in log space, and is below zero, it shouldnt be plotted, so the corresponding var is removed
                trans_y.pop();
              } else {
                new_x.push(Math.log10(x_data[i]));
              }
            case 'exp':
              new_x.push(Math.pow(10,x_data[i]));
              break;
            default:
              break;
          }
		    }
	    }
      y_basis = 'log';
	    return [new_x, trans_y];
    }

    // function changeInputBasis(){ //returns the data modified to the correct basis; in the correct format to be sent via ajax (same as inputDataContents)
	  //   var datapoint;
	  //   var newInputData = "";

	  //   var inputDataContents = document.getElementById('inputTextAreaData').value;
    //   var inputData_Arr_unsorted = inputDataContents.split("\n");
	  //   var inputData_Arr = [];

	  //   for (var i = 0; i < inputData_Arr_unsorted.length; i++){ //gets rid of blank lines
		//     if ((inputData_Arr_unsorted[i] != "") && (inputData_Arr_unsorted[i] != " "))
		// 	    inputData_Arr.push(inputData_Arr_unsorted[i]);
	  //   }
	  //   var N = inputData_Arr.length;


	  //   var has_Weights = $('#Weighted').data('clicked');

	  //   if (has_Weights){
		//     switch(y_basis){
		// 	    case 'linear':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 3){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           w = datapoint[2];
    //           newInputData += datapoint[0] + " " + datapoint[1] + " " +  w + "\n";
    //         }
    //         inputDataContents = newInputData;
		// 		    break;
		// 	    case 'log':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 3){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           w = datapoint[2];
    //           if (Number(datapoint[1]) > 0){
    //             newInputData += datapoint[0] + " " + Math.log10(Number(datapoint[1])).toString() + " " +  w + "\n";
    //           }
    //         }
    //         inputDataContents = newInputData;
    //         break;
		// 	    case 'exp':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 3){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           w = datapoint[2];
    //           newInputData += datapoint[0] + " " + Math.pow(10, Number(datapoint[1])).toString() + " " +  w + "\n";
    //         }
    //         inputDataContents = newInputData;

		// 		    break;
		// 	    default:
		// 		    break;
		//     }
	  //   } else {
		//     switch(y_basis){
		// 	    case 'linear':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 2){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           newInputData += datapoint[0] + " " + datapoint[1] + "\n";
    //         }
    //         inputDataContents = newInputData;
		// 		    break;
		// 	    case 'log':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 2){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           if (Number(datapoint[1]) > 0){
    //             newInputData += datapoint[0] + " " + Math.log10(Number(datapoint[1])).toString() + "\n";
    //           }
    //         }
    //         inputDataContents = newInputData;

		// 		    break;
		// 	    case 'exp':

    //         for (var i = 0; i < N; i++){
    //           datapoint = inputData_Arr[i].split("\t");
    //           if (datapoint.length < 2){ //if not tab seperated, try space seperated
    //             datapoint = inputData_Arr[i].split(" ");
    //           }
    //           newInputData += datapoint[0] + " " + Math.pow(10, Number(datapoint[1])).toString() + "\n";
    //         }
    //         inputDataContents = newInputData;

		// 		    break;
		// 	    default:
		// 		    break;
		//     }

	  //   }

	  //   return inputDataContents;
    // }

    function getHistData(paramHistogramsData) {
        let paramHistograms = [];

        paramHistogramsData = paramHistogramsData.split("\n")
        for (let m = 0; m < paramHistogramsData.length; m++) {
            let inner = paramHistogramsData[m].split("\t");
            if (inner.length < 2){ //if not tab seperated, try space seperated
              inner = paramHistogramsData[m].split(" ");
            }
            let bothsigs = [];
            for (let n = 0; n < 2; n++) {
                let inter = inner[n].split(" ");
                let sigs = [];
                for (let i = 0; i < inter.length; i++) {
                    sigs.push(Number(inter[i]));
                }
                bothsigs.push(sigs);
            }
            //bothsigs = [hist, edges]
            paramHistograms.push(bothsigs);
        }

        return paramHistograms;
    }

    function getData(){
	    var has_Weights = $('#Weighted').data('clicked');

        var x_data = [];
	    var y_data = [];
        var w_data = [];
        let err_x_data = [];
        let err_y_data = [];

	    var inputData = document.getElementById('inputTextAreaData').value;

        var inputData_Arr_unsorted = inputData.split("\n");
	    var inputData_Arr = [];

	    for (var i = 0; i < inputData_Arr_unsorted.length; i++){ //gets rid of blank lines
		    if ((inputData_Arr_unsorted[i] != "") && (inputData_Arr_unsorted[i] != " "))
			    inputData_Arr.push(inputData_Arr_unsorted[i]);
	    }

	    var N = inputData_Arr.length;

        //console.log(inputData_Arr);
	    if (has_Weights){
        for (var i = 0; i < N; i++){
    	    datapoint = inputData_Arr[i].split("\t");
    	    if (datapoint.length < 5){ //if not tab seperated, try space seperated
    		    datapoint = inputData_Arr[i].split(" ");
    	    }
          if (datapoint.length < 5){ // at this point, data must be missing
            if (datapoint.length === 4){
              alert("Check data:  Missing weights!");
              return;
            } else {
              alert("Check input:  Missing data!");
              return;
            }
          }
          x_data.push(Number(datapoint[0]));
          err_x_data.push(Number(datapoint[1]));
          y_data.push(Number(datapoint[2]));
          err_y_data.push(Number(datapoint[3]));
				  w_data.push(Number(datapoint[4]));
		    }
		    return [x_data, err_x_data, y_data, err_y_data, w_data];
	    } else {
            for (var i = 0; i < N; i++){
    	        datapoint = inputData_Arr[i].split("\t");
    	        if (datapoint.length < 2){ //if not tab seperated, try space seperated
    		        datapoint = inputData_Arr[i].split(" ");
    	        }
                x_data.push(Number(datapoint[0]));
                err_x_data.push(Number(datapoint[1]));
                y_data.push(Number(datapoint[2]));
                err_y_data.push(Number(datapoint[3]));
		        }
		    }
        return [x_data, err_x_data, y_data, err_y_data];
    }

    function getBands(x_m, y_m, params) {
      let dFunc;

      switch (chosenFunctionType){
        case "Linear":
          dFunc = dLinear;
          break;
        case "Quadratic":
          dFunc = dQuadratic;
          break;
        case "Cubic":
          dFunc = dCubic;
          break;
        case "PowerLaw":
          dFunc = dPowerLaw
          break;
        case "Exponential":
          dFunc = dExponential;
          break;
        case "Logarithmic":
          dFunc = dLogarithmic;
          break;
        default:
          dFunc = dLinear;
          break;
      }

      let sx = parameters[parameters.length - 2];
      let sy = parameters[parameters.length - 1];

      let shiftY = [];

      for (let i = 0; i < y_m.length; i++){
        let dF = dFunc(x_m[i], params, pivot);
        //console.log(dF)
        shiftY.push(Math.sqrt(Math.pow(sy, 2.0) + Math.pow(dF * sx, 2.0)));
      }

      //console.log(x_m, shiftY)

      let lower1 = y_m.map((x, i) => x - shiftY[i]);
      let lower2 = y_m.map((x, i) => x - 2*shiftY[i]);
      let lower3 = y_m.map((x, i) => x - 3*shiftY[i]);
      let upper1 = y_m.map((x, i) => x + shiftY[i]);
      let upper2 = y_m.map((x, i) => x + 2*shiftY[i]);
      let upper3 = y_m.map((x, i) => x + 3*shiftY[i]);

      console.log("Get Bands:", lower1, lower2, lower3, upper1, upper2, upper3)

      return [lower1, lower2, lower3, upper1, upper2, upper3]
    }

    function linspace(startValue, stopValue, cardinality) {
        var arr = [];
        var step = (stopValue - startValue) / (cardinality - 1);
        for (var i = 0; i < cardinality; i++) {
            arr.push(startValue + (step * i));
        }
        return arr;
    }

    function getModelData() {
        let input_data = getData();
        let x_data = input_data[0];
        let xmin = Math.min(...x_data);
        let xmax = Math.max(...x_data);
        let margin = (xmax - xmin) / 2.0;
        let x_original_result = linspace(xmin - margin, xmax + margin, 1000);
        
        let y_fitted_result = [];

        let parameters_result = parameters.slice(0, -2);

        switch (chosenFunctionType) {
            case "Linear":
                var a0 = parameters_result[0];
                var a1 = parameters_result[1];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 + a1 * (x_original_result[i] - pivot))
                    y_fitted_result.push(y_point)
                }
                break;
            case "Quadratic":

                var a0 = parameters_result[0];
                var a1 = parameters_result[1];
                var a2 = parameters_result[2];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 + a1 * (x_original_result[i] - pivot) + a2 * Math.pow((x_original_result[i] - pivot), 2.0))
                    y_fitted_result.push(y_point)
                }
                break;
            case "Cubic":

                var a0 = parameters_result[0];
                var a1 = parameters_result[1];
                var a2 = parameters_result[2];
                var a3 = parameters_result[3];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 + a1 * (x_original_result[i] - pivot) + a2 * Math.pow((x_original_result[i] - pivot), 2.0) + a3 * Math.pow((x_original_result[i] - pivot), 3.0))
                    y_fitted_result.push(y_point)
                }
                break;
            case "PowerLaw":

                var a0 = parameters_result[0];
                var a1 = parameters_result[1];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 * Math.pow((x_original_result[i] / Math.pow(10, pivot)), a1))
                    y_fitted_result.push(y_point)
                }
                break;
            case "Exponential":

                var a0 = parameters_result[0];
                var a1 = parameters_result[1];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 * Math.pow(10, a1 * (x_original_result[i] - pivot)))
                    y_fitted_result.push(y_point)
                }
                break;
            case "Logarithmic":

                var a0 = parameters_result[0];
                var a1 = parameters_result[1];

                for (var i = 0; i < x_original_result.length; i++) {
                    var y_point = (a0 + a1 * Math.log10(x_original_result[i]/Math.pow(10, pivot)))
                    y_fitted_result.push(y_point)
                }
                break;
            default:
                console.log("Error: no model function selected");
        }

        // console.log("x_original_result:");
        // console.log(x_original_result);

        // console.log("y_fitted_result:");
        // console.log(y_fitted_result);

        return [x_original_result, y_fitted_result, parameters[parameters.length - 1], parameters]; //returns x and y data for model curve and slop_y
    }

    function convertData(inputDataContents){ //convert from new format to old format
      var has_Weights = $('#Weighted').data('clicked');

      var x_data = [];
      var y_data = []; //these are lists of strings
	    var w_data = [];

      console.log("inputDataContents: " + inputDataContents);

      mainDataContents = "";
      xDataContents = "";
      var inputData_Arr_unfiltered = inputDataContents.split("\n");
	    var inputData_Arr = [];

	    for (var i = 0; i < inputData_Arr_unfiltered.length; i++){ //gets rid of blank lines
		    if ((inputData_Arr_unfiltered[i] != "") && (inputData_Arr_unfiltered[i] != " "))
			    inputData_Arr.push(inputData_Arr_unfiltered[i]);
	    }
	    var N = inputData_Arr.length;

      console.log("inputData_Arr: " + inputData_Arr);

      if (has_Weights){ //creates lists of data (list of strings)
        for (var i = 0; i < N; i++){
    	    datapoint = inputData_Arr[i].split("\t");
          if (datapoint.length < 2){ //if not tab seperated, try space seperated
              datapoint = inputData_Arr[i].split(" ");
            }
    	    if (datapoint.length < 3){ //if not tab seperated, try space seperated
    		    datapoint = inputData_Arr[i].split(" ");
    	    }
            x_data.push(datapoint[0]);
            y_data.push(datapoint[1]);
            w_data.push(datapoint[2]);
		    }
	    } else {
          for (var i = 0; i < N; i++){
      	    datapoint = inputData_Arr[i].split("\t");
            if (datapoint.length < 2){ //if not tab seperated, try space seperated
              datapoint = inputData_Arr[i].split(" ");
            }
      	    if (datapoint.length < 2){ //if not tab seperated, try space seperated
      		    datapoint = inputData_Arr[i].split(" ");
      	    }
              x_data.push(datapoint[0]);
              y_data.push(datapoint[1]);
  		    }
		    }

      for (var i = 0; i < N; i++){
        xDataContents += x_data[i] + "\n";
      }

      if (has_Weights){ //adds data to old format strings
        for (var i = 0; i < N; i++){
    	    mainDataContents += y_data[i] + " " + w_data[i] + "\n";
		    }
	    }
      else {
        for (var i = 0; i < N; i++){
    	    mainDataContents += y_data[i] + "\n";
		    }
	    }

      console.log(xDataContents);
      console.log(mainDataContents);

      return [mainDataContents, xDataContents];
    }

    function functionSelector(functionName){
      chosenFunctionType = functionName;
      console.log('Function chosen: ' + chosenFunctionType)
    }
    /*
    function getBar(xArr, fType, params, wArr = []){ //gets custom "bar" function, ie xBar, logxBar, etc depending on model
      if (wArr === []){ //if equal weights
        for (var i = 0; i < xArr.length; i++){
          wArr.push(1.0);
        }
      }

      var lowerSum = 0;
      var upperSum = 0;
      for (var i = 0; i < xArr.length; i++){
      switch (fType){
        case 'PowerLaw':
        for (var i = 0; i < xArr.length; i++){
          double y_i = f(xArr[i], params);
  		    uppersum += wArr[i] * Math.log10(xArr[i]) * Math.pow(y_i, 2.0);
  		    lowersum += wArr[i] * Math.pow(10.0, -2.0*y_i);
        }
        break;

        case 'Exponential':
        case 'Logarithmic':
        default:
          for (var i = 0; i < xArr.length; i++){
            uppersum += (xArr[i] * wArr[i]);
            lowersum += w[i];
          }
          break;
      }
      return (upperSum / lowerSum);
    }
    */
    function displayChosenFunction(t){
      document.getElementById("SelectedFunction").innerHTML = t.innerHTML;
      return;
    }
    /*
    function displayBar(){
      var has_Weights = $('#Weighted').data('clicked');
	    var has_ErrorBars = $('#ErrorBars').data('clicked');
      var res = getData();

      var x = res[0];
      var xBar;

      if (has_Weights){
        var w = res[2];
        xBar = getWeightedXBar(x, w);
        document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);

      } else if (has_ErrorBars){
        var w = res[2].map(x => 1.0/Math.pow(x, 2.0));
        xBar = getWeightedXBar(x, w);
        document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);
      } else  {
        xBar = getXBar(x);
        document.getElementById("XBarDisplay").innerHTML = String(Math.round(xBar * 1000) / 1000);
      }
      return;
    }

    function displayLogBar(){

    }
    */
    function displayBar(t){
      var chosenFn = t.id;
      switch (chosenFn){
        case "PowerLaw":
          document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">log x</span> = ฮฃ<sub>i</sub>w<sub>i</sub>(log x<sub>i</sub>)y<sup>2</sup>(x<sub>i</sub>) / ฮฃ<sub>i</sub>w<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>)";
          document.getElementById("xBarType").innerHTML = "log x";
          document.getElementById("xBarInp").innerHTML = "log x";
          document.getElementById("xBarOut").innerHTML = "log x";
          break;
        case "Exponential":
          document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">x</span> = ฮฃ<sub>i</sub>w<sub>i</sub>x<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>) / ฮฃ<sub>i</sub>w<sub>i</sub>y<sup>2</sup>(x<sub>i</sub>)";
          document.getElementById("xBarType").innerHTML = "x";
          document.getElementById("xBarInp").innerHTML = "x";
          document.getElementById("xBarOut").innerHTML = "x";
          break;
        case "Logarithmic":
          document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">log x</span> = ฮฃ<sub>i</sub>w<sub>i</sub>(log x<sub>i</sub>)10<sup>-2y(x<sub>i</sub>)</sup> / ฮฃ<sub>i</sub>w<sub>i</sub>10<sup>-2y(x<sub>i</sub>)</sup>";
          document.getElementById("xBarType").innerHTML = "log x";
          document.getElementById("xBarInp").innerHTML = "log x";
          document.getElementById("xBarOut").innerHTML = "log x";
          break;
        default:
          document.getElementById("XBarDisplay").innerHTML = "<span style=\"text-decoration:overline\">x</span> = ฮฃ<sub>i</sub>w<sub>i</sub>x<sub>i</sub> / ฮฃ<sub>i</sub>w<sub>i</sub>";
          document.getElementById("xBarType").innerHTML = "x";
          document.getElementById("xBarInp").innerHTML = "x";
          document.getElementById("xBarOut").innerHTML = "x";
          break;
      }
      return;
    }

    function displayPivotSection(t){
      var chosenFn = t.id;
      switch (chosenFn){
        case "Linear":
          $('#pivotSection').css('display','inline');
          break;
        case "PowerLaw":
          $('#pivotSection').css('display','inline');
          break;
        case "Exponential":
          $('#pivotSection').css('display','inline');
          break;
        case "Logarithmic":
          $('#pivotSection').css('display','inline');
          break;
        default:
          $('#pivotSection').css('display','none');
          break;
      }
      return;
    }

    function createBasisNotice(){
      switch(y_basis){
        case 'linear': 
          $('#BasisNotice').css('display','none');
          break;
        case 'log':
          document.getElementById("BasisNotice").innerHTML = "Notice: All results shown below are in the chosen logarithmic basis for y(x)."
          $('#BasisNotice').css('display','block');
          break;
        case 'exp':
          document.getElementById("BasisNotice").innerHTML = "Notice: All results shown below are in the chosen exponential basis for y(x)."
          $('#BasisNotice').css('display','block');
          break;
        default:
          break;
      }
    }

    function overRejPercentage(N){
 		    //N is data size/ number of data points
		    var percentageArray = [46.435,65.717,65.717,0.127,
													    25.547,48.491,48.491,0.039,
													    25.442,29.97,32.381,0.014,
													    14.362,20.828,24.589,0.007,
													    10.112,14.305,19.601,0.002,
													    7.554,9.961,15.853,0.003,
													    5.941,7.138,13.151,0.003,
													    4.155,5.06,10.952,0,
													    3.576,3.702,9.448,0,
													    2.694,2.665,7.915,0,
													    2.199,2.063,6.912,0,
													    1.736,1.506,5.813,0,
													    1.405,1.17,5.061,0,
													    1.161,0.945,4.377,0,
													    1.039,0.719,3.802,0,
													    0.867,0.53,3.282,0,
													    0.726,0.468,2.961,0,
													    0.657,0.346,2.573,0,
													    0.597,0.304,2.326,0,
													    0.495,0.239,2.037,0,
													    0.416,0.183,1.856,0,
													    0.365,0.168,1.642,0,
													    0.289,0.126,1.51,0,
													    0.277,0.109,1.347,0,
													    0.256,0.091,1.22,0,
													    0.251,0.075,1.149,0,
													    0.21,0.056,1.023,0,
													    0.209,0.044,0.918,0,
													    0.189,0.043,0.874,0,
													    0.178,0.033,0.811,0,
													    0.17,0.024,0.722,0,
													    0.153,0.024,0.649,0,
													    0.132,0.014,0.592,0,
													    0.113,0.021,0.566,0,
													    0.1,0.018,0.537,0,
													    0.09,0.014,0.479,0,
													    0.083,0.021,0.451,0,
													    0.075,0.013,0.418,0,
													    0.074,0.013,0.418,0,
													    0.067,0.007,0.375,0,
													    0.054,0.009,0.365,0,
													    0.047,0.006,0.323,0,
													    0.045,0.004,0.314,0,
													    0.044,0.004,0.287,0,
													    0.045,0.002,0.286,0,
													    0.037,0.003,0.251,0,
													    0.028,0,0.223,0,
													    0.026,0.004,0.221,0,
													    0.021,0.003,0.221,0,
													    0.025,0.003,0.224,0,
													    0.021,0.001,0.201,0,
													    0.019,0.001,0.189,0,
													    0.016,0.001,0.18,0,
													    0.017,0.003,0.176,0,
													    0.014,0.003,0.162,0,
													    0.014,0.002,0.145,0,
													    0.013,0.003,0.137,0,
													    0.012,0.004,0.132,0,
													    0.008,0.002,0.122,0,
													    0.009,0.002,0.105,0,
													    0.011,0.001,0.103,0,
													    0.01,0.001,0.095,0,
													    0.009,0.002,0.086,0,
													    0.008,0.003,0.086,0,
													    0.011,0.001,0.085,0,
													    0.013,0.002,0.088,0,
													    0.011,0.001,0.08,0,
													    0.007,0.001,0.086,0,
													    0.004,0,0.078,0,
													    0.005,0,0.075,0,
													    0.007,0,0.074,0,
													    0.004,0.002,0.06,0,
													    0.005,0,0.062,0,
													    0.008,0,0.063,0,
													    0.008,0.002,0.06,4,0,
													    0.008,0.001,0.057,0,
													    0.006,0.001,0.062,0,
													    0.006,0.001,0.055,0,
													    0.008,0,0.053,0,
													    0.005,0,0.05,0,
													    0.005,0.001,0.048,0,
													    0.004,0,0.046,0,
													    0.005,0,0.049,0,
													    0.005,0,0.045,0,
													    0.004,0,0.043,0,
													    0.005,0,0.039,0,
													    0.004,0,0.036,0,
													    0.004,0,0.042,0,
													    0.004,0.001,0.042,0,
													    0.003,0,0.034,0,
													    0.004,0,0.037,0,
													    0.004,0,0.035,0,
													    0.003,0,0.028,0,
													    0.003,0,0.028,0,
													    0.002,0,0.029,0,
													    0.002,0,0.027,0,
													    0.002,0,0.027,0];

		    var percentage2DArr = []; //converts the percentage data to a 2d array
  	    for (var i = 0; i < 97; i++){
  		    percentage2DArr.push(percentageArray.slice(0 + 4*i, 4 + 4*i));
  	    }

		    var hasSymm = $('#Symmetric').data('clicked');
        var hasEq = $('#Equal').data('clicked');
        var hasOne = $('#OneSided').data('clicked');
        var hasInBet = $('#Between').data('clicked');

		    var rej; //rej corresponds to the number of the column of rcr_overrejectionprecentages.csv

		    if (hasSymm){
			    if (hasEq){
				    rej = 0; //'ss_med_dl'
			    } else if (hasOne){
				    rej = 1;
			    } else if (hasInBet){
				    rej = 2;
			    }
		    } else {
			    rej = 3;
		    }

		    var percentage = Math.round( percentage2DArr[N-3][rej] * 10) / 10;
		    //rounds to first decimal place
		    return percentage;
    }

    function createOverRejectionNotice(){
      var N = (getData()[0]).length;

      if (N < 3){
        document.getElementById("OverRejectionNotice").innerHTML = "Note: Please enter at least three, properly formatted data points.";
        $('#OutputTableWrapper').css('display','none');
        $('#OverRejectionNote').css('display','block');
        return true;
      }

      if (N >= 3 && N <= 99){
        var perc = overRejPercentage(N);
        if (perc < 0.1){
          document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%."
        } else if (perc >= 0.1){
        document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is " + perc.toString() +"%.";
        }
      } else if (N > 99){
        document.getElementById("OverRejectionNotice").innerHTML = "Note: Chance of runaway overrejection is <0.1%.";
      }
      $('#OverRejectionNote').css('display','block');

      return;
    }

    function showPriorsBox(show){
      if (show){
        $('#priorsBox').css('display','inline');
        $('#priorsInput').css('display','inline');
      }
      else {
        $('#priorsBox').css('display','none');
        $('#priorsInput').css('display','none');
      }
    }

    function convertSigmaData(bestFit_123SigmasData) {
        let bestFit_123Sigmas = [];

        bestFit_123SigmasData = bestFit_123SigmasData.split("\n")
        for (let m = 0; m < bestFit_123SigmasData.length; m++) {
            let inner = bestFit_123SigmasData[m].split("\t");
            if (inner.length < 2){ //if not tab seperated, try space seperated
              inner = bestFit_123SigmasData[m].split(" ");
            }
            let bothsigs = [];
            for (let n = 0; n < 2; n++) {
                let inter = inner[n].split(" ");
                let sigs = [];
                for (let i = 0; i < 3; i++) {
                    sigs.push(Number(inter[i]));
                }
                bothsigs.push(sigs);
            }
            bestFit_123Sigmas.push(bothsigs);
        }

        return bestFit_123Sigmas;
    }

    function roundNumber(num, dec) {
      return Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec);
    }

    function displayOutputs(data) {
        document.getElementById('finalParameters').value = data['finalParametersData'];
        if (findPivot){
          newStr = document.getElementById('finalParameters').value;
          newStr.concat("\nPivot:\n", toString(pivot));
          document.getElementById('finalParameters').value = newStr;
        }
        document.getElementById('scales').value = data['scales']; //assuming scales = "s0\na\nb"
        if (doMCMC){
          document.getElementById('parameterSigmas').value = data['bestFit_123SigmasData'];
        }

        return;
    }

    function getScale(){
      let scale;
      let val = document.getElementById('scaleArea').value;

      val.replace(" ","")
      val.replace("\t", "")

      if (val === ""){
        scale = 1.0;
      } else if (val.length > 0 && typeof Number(val) == "number"){
        scale = Number(val);
      }


      return scale;
    }

    function performTRK(){

      var mainDataContents = document.getElementById('inputTextAreaData').value;
      
      guessDataContents = document.getElementById('guessarea').value
      priorsDataContents = document.getElementById('priorsArea').value


      doScale = $('#OpScale').data('clicked');
      doMCMC = $('#YesMCMC').data('clicked');

      hasWeights = $('#Weighted').data('clicked');
      hasPriors = $('#YesPriors').data('clicked');
      findPivot = $('#YesPivot').data('clicked');

      chosenScale = getScale();

      console.log("scale: " + chosenScale.toString());
      console.log("mainDataContents:" + mainDataContents);
      console.log("guessDataContents:" + guessDataContents);
      console.log("doScale: " + doScale);
	    console.log("doMCMC: " + doMCMC);
	    console.log("hasWeights: " + hasWeights);
      console.log("chosenFunctionType: " + chosenFunctionType);
      console.log("hasPriors: " + hasPriors);
      console.log("priorsDataContents: " + priorsDataContents);
      console.log("findPivot: " + findPivot);

      var request = $.ajax
          (
              {
                  url: '/rcr/calculator/callTRK',
                  type: "POST",
                  data: { mainData : mainDataContents,
                          guessData : guessDataContents,
                          weighted :  hasWeights,
                          functionType : chosenFunctionType,
                          priorsData : priorsDataContents,
                          hasPriors : hasPriors,
                          findPivot : findPivot,
                          optimizeScale : doScale,
                          findUncertainties : doMCMC,
                          scale : chosenScale.toString()
                        },
                  dataType: "json",
                  success: function(data, textStatus, jqXHR)
                  {
                    $('#OutputTableWrapper').css('display', 'inline');
                    $('#OutputPlot').css('display', 'inline');
                    if (doMCMC){
                      $('#Histogram').css('display', 'inline');
                    } else {
                    $('#Histogram').css('display', 'none');
                    }
                    console.log('yes');
                    console.log(data);

                    var parameters_result = data['finalParametersData'].split("\n");
                    parameters = parameters_result.map(Number);

                    console.log("parameters:", parameters)

                    if (doMCMC){
                      bestFit_123Sigmas = convertSigmaData(data['bestFit_123SigmasData']);
                      paramHistograms = getHistData(data['paramHistogramData']);
                    }

                    pivot = Number(data['pivotData']);

                    displayOutputs(data);
                  },
                  error: function (jqXHR, textStatus, errorThrown)
                  {
                      console.log(errorThrown)
                      console.log('no');
                      console.log(jqXHR);
                      console.log(textStatus);
                  },
                  timeout: 600000
              }
          );



      }

    function type(){
            $('#priorsBox').css('display','none');
            $('#priorsInput').css('display','none');
            $('#SelectContaminantSection').css('display','block');
            $('#OutputTableWrapper').css('display', 'inline');

            $('#pivotSection').css('display','none');

            $('#YesScaleYesMCMC').css('display', 'none');
            $('#NoScaleYesMCMC').css('display', 'none');
            $('#NoScaleNoMCMC').css('display', 'none');
            $('#YesScaleNoMCMC').css('display', 'none');

            $('#Option11').css('display','none');
            $('#Option10').css('display','none');
            $('#Option01').css('display','none');
            $('#Option00').css('display','none');

            $('#Histogram').css('display','none');
            $('#OutputPlot').css('display','none');

            document.getElementById("SelectContaminantSectionTitle").innerHTML = "Generate Model Parameter Distributions/Uncertainties?";
      	    document.getElementById("PerformTRK").innerHTML = "Perform Fit!";
            $('#OutputTableWrapper').css('display','none');

            switch (true)
		    {
                case ($('#OpScale').data('clicked') && $('#YesMCMC').data('clicked')):
                    $('.RejectionMethods').css('display','none')
                    $('#Option11').css('display','block');
                    $('#Option10').css('display','none');
                    $('#Option01').css('display','none');
                    $('#Option00').css('display','none');
                    $('#OptionAll').css('display','block');
                    $('#YesScaleYesMCMC').css('display', 'block');
                    $('#selectScale').css('display', 'none')
                    $('#Histogram').css('display','block');
                    break;
                case ($('#OpScale').data('clicked') && $('#NoMCMC').data('clicked')):
                    $('.RejectionMethods').css('display', 'none')
                    $('#Option11').css('display','none');
                    $('#Option10').css('display','block');
                    $('#Option01').css('display','none');
                    $('#Option00').css('display','none');
                    $('#OptionAll').css('display', 'block');
                    $('#YesScaleNoMCMC').css('display', 'block');
                    $('#selectScale').css('display', 'none')
                    break;
                case ($('#NoOpScale').data('clicked') && $('#YesMCMC').data('clicked')):
                    $('.RejectionMethods').css('display', 'none')
                    $('#Option11').css('display','none');
                    $('#Option10').css('display','none');
                    $('#Option01').css('display','block');
                    $('#Option00').css('display','none');
                    $('#OptionAll').css('display', 'block');
                    $('#NoScaleYesMCMC').css('display', 'block');
                    $('#selectScale').css('display', 'block')
                    $('#Histogram').css('display','block');
                    break;
                case ($('#NoOpScale').data('clicked') && $('#NoMCMC').data('clicked')):
                    $('.RejectionMethods').css('display', 'none')
                    $('#Option11').css('display','none');
                    $('#Option10').css('display','none');
                    $('#Option01').css('display','none');
                    $('#Option00').css('display','block');
                    $('#OptionAll').css('display', 'block');
                    $('#NoScaleNoMCMC').css('display', 'block');
                    $('#selectScale').css('display', 'block')
                    break;

          //case ($('#Linear').data('clicked')):
          //  $('#LinearImage').css('display', 'block');
          //          break;
          //case ($('#Quadratic').data('clicked')):
          //  $('#QuadraticImage').css('display', 'block');
          //          break;
          //case ($('#Cubic').data('clicked')):
          //  $('#CubicImage').css('display', 'block');
          //          break;
          //case ($('#PowerLaw').data('clicked')):
          //  $('#PowerLawImage').css('display', 'block');
          //          break;
          //case ($('#Exponential').data('clicked')):
          //  $('#ExponentialImage').css('display', 'block');
          //          break;
          //case ($('#Logarithmic').data('clicked')):
          //  $('#LogarithmicImage').css('display', 'block');
          //          break;


          /*
			    case ($('#Nongaussian').data('clicked')):
				    $('.RejectionMethods').css('display','none')
				    $('#Option3').css('display','block');
				    $('#Option3Image').css('display', 'block');

                    $('#RCRNote').css('display','none');
                    $('#SelectContaminantSection').css('display','none');
        	    $('#OutputTableWrapper').css('display','none');
          */

		    //document.getElementById("SelectContaminantSectionTitle").innerHTML = "We do not perform outlier rejection in this case.";
		    //document.getElementById("PerformRCR").innerHTML = "Characterize!";

                    //$('#NonRCRNote').css('display','block');

                    break;
			    default:
				    $('.RejectionMethods').css('display','none')

            };
    };

    function toggleBool(button)	{
		    if ($(button).data('clicked') === false)
		    {
			    $(button).data('clicked',true);
			    return;
		    }
		    else if ($(button).data('clicked') === true)
		    {
			    $(button).data('clicked', false);
		    }
	    };

    function SingleActiveButtonCheck(button1, button2){
	    if ($(button1).data('clicked') === true && $(button2).data('clicked') === true)
	    {
		    toggleBool($(button2))
		    $(button2).toggleClass('ButtonActive');
	    }
    };

    function SingleActiveButtonCheckNoBool(button1, button2){
	    if ($(button1).hasClass('ButtonActive')&& $(button2).hasClass('ButtonActive'))
	    {
        //console.log(chosenFunctionType);
		    $(button2).toggleClass('ButtonActive');
	    }
    };

    function main(){
      console.log("running main");
        //Initialize buttons
	    $('#OpScale').data('clicked',true);
	    $('#NoOpScale').data('clicked',false);

	    $('#YesMCMC').data('clicked',false);
	    $('#NoMCMC').data('clicked',true);

	    $('#Unweighted').data('clicked',true);
	    $('#Weighted').data('clicked',false);

        $('#NoPriors').data('clicked', true);
      $('#YesPriors').data('clicked',false);

      $('#NoPivot').data('clicked', true);
	    $('#YesPivot').data('clicked',false);

        $('#Linear').data('clicked',true);

        $('#NoPriors').toggleClass('ButtonActive');
        $('#NoPivot').toggleClass('ButtonActive');
        $('#Unweighted').toggleClass("ButtonActive");
        $('#OpScale').toggleClass("ButtonActive");
        $('#NoMCMC').toggleClass("ButtonActive");
        

	    type();

        //the below are handlers for when buttons are clicked

        $('#OpScale').click(function() {
            if ($('#OpScale').data('clicked') === false)
            {
                toggleBool('#OpScale');
                $('#OpScale').toggleClass('ButtonActive');
                SingleActiveButtonCheck('#OpScale','#NoOpScale');
                //SingleActiveButtonCheck('#Symmetric','#Nongaussian');
                type();
            }
	    });
        $('#NoOpScale').click(function() {
            if ($('#NoOpScale').data('clicked') === false)
            {
                toggleBool('#NoOpScale');
                $('#NoOpScale').toggleClass('ButtonActive');
                SingleActiveButtonCheck('#NoOpScale','#OpScale');
                //SingleActiveButtonCheck('#Asymmetric','#Nongaussian');
                type();
            }
        });
        $('#YesMCMC').click(function() {
            if ($('#YesMCMC').data('clicked') === false)
            {
                toggleBool('#YesMCMC');
                $('#YesMCMC').toggleClass('ButtonActive');
                SingleActiveButtonCheck('#YesMCMC','#NoMCMC');
                type();
            }
        });
        $('#NoMCMC').click(function() {
            if ($('#NoMCMC').data('clicked') === false)
            {
                toggleBool('#NoMCMC');
                $('#NoMCMC').toggleClass('ButtonActive');
                SingleActiveButtonCheck('#NoMCMC','#YesMCMC');
                type();
            }
        });
     

        $('#Unweighted').click(function()	{
              if ($('#Unweighted').data('clicked') === false)
              {
                  $('#Unweighted').toggleClass("ButtonActive");
                  toggleBool('#Unweighted');
                  SingleActiveButtonCheck('#Unweighted','#Weighted');
              }
  	    });
  	    $('#Weighted').click(function()	{
              if ($('#Weighted').data('clicked') === false)
              {
                  $('#Weighted').toggleClass("ButtonActive");
                  toggleBool('#Weighted');
                  SingleActiveButtonCheck('#Weighted','#Unweighted');
              }
  	    });
        $('#NoPriors').click(function()	{
              if ($('#NoPriors').data('clicked') === false)
              {
                  $('#NoPriors').toggleClass("ButtonActive");
                  toggleBool('#NoPriors');
                  SingleActiveButtonCheck('#NoPriors','#YesPriors');
              }
  	    });
        $('#YesPriors').click(function()	{
              if ($('#YesPriors').data('clicked') === false)
              {
                  $('#YesPriors').toggleClass("ButtonActive");
                  toggleBool('#YesPriors');
                  SingleActiveButtonCheck('#YesPriors','#NoPriors');
              }
        });
        $('#NoPivot').click(function()	{
              if ($('#NoPivot').data('clicked') === false)
              {
                  $('#NoPivot').toggleClass("ButtonActive");
                  toggleBool('#NoPivot');
                  SingleActiveButtonCheck('#NoPivot','#YesPivot');
              }
  	    });
        $('#YesPivot').click(function()	{
              if ($('#YesPivot').data('clicked') === false)
              {
                  $('#YesPivot').toggleClass("ButtonActive");
                  toggleBool('#YesPivot');
                  SingleActiveButtonCheck('#YesPivot','#NoPivot');
              }
  	    });


      $('#Linear').click(function()	{
            functionSelector('Linear');
            $('#Linear').toggleClass("ButtonActive");
            //console.log('hey')
            SingleActiveButtonCheckNoBool('#Linear','#Quadratic');
            SingleActiveButtonCheckNoBool('#Linear','#Cubic');
            SingleActiveButtonCheckNoBool('#Linear','#PowerLaw');
            SingleActiveButtonCheckNoBool('#Linear','#Exponential');
            SingleActiveButtonCheckNoBool('#Linear','#Logarithmic');

	    });

      $('#Quadratic').click(function()	{
            functionSelector('Quadratic');
            $('#Quadratic').toggleClass("ButtonActive");
            SingleActiveButtonCheckNoBool('#Quadratic','#Linear');
            SingleActiveButtonCheckNoBool('#Quadratic','#Cubic');
            SingleActiveButtonCheckNoBool('#Quadratic','#PowerLaw');
            SingleActiveButtonCheckNoBool('#Quadratic','#Exponential');
            SingleActiveButtonCheckNoBool('#Quadratic','#Logarithmic');

	    });

      $('#Cubic').click(function()	{
            functionSelector('Cubic');
            $('#Cubic').toggleClass("ButtonActive");
            SingleActiveButtonCheckNoBool('#Cubic','#Linear');
            SingleActiveButtonCheckNoBool('#Cubic','#Quadratic');
            SingleActiveButtonCheckNoBool('#Cubic','#PowerLaw');
            SingleActiveButtonCheckNoBool('#Cubic','#Exponential');
            SingleActiveButtonCheckNoBool('#Cubic','#Logarithmic');

	    });

      $('#PowerLaw').click(function()	{
            functionSelector('PowerLaw');
            $('#PowerLaw').toggleClass("ButtonActive");
            SingleActiveButtonCheckNoBool('#PowerLaw','#Linear');
            SingleActiveButtonCheckNoBool('#PowerLaw','#Quadratic');
            SingleActiveButtonCheckNoBool('#PowerLaw','#Cubic');
            SingleActiveButtonCheckNoBool('#PowerLaw','#Exponential');
            SingleActiveButtonCheckNoBool('#PowerLaw','#Logarithmic');

	    });

      $('#Exponential').click(function()	{
            functionSelector('Exponential');
            $('#Exponential').toggleClass("ButtonActive");
            SingleActiveButtonCheckNoBool('#Exponential','#Linear');
            SingleActiveButtonCheckNoBool('#Exponential','#Quadratic');
            SingleActiveButtonCheckNoBool('#Exponential','#Cubic');
            SingleActiveButtonCheckNoBool('#Exponential','#PowerLaw');
            SingleActiveButtonCheckNoBool('#Exponential','#Logarithmic');

      });

      $('#Logarithmic').click(function()	{
            functionSelector('Logarithmic');
            $('#Logarithmic').toggleClass("ButtonActive");
            SingleActiveButtonCheckNoBool('#Logarithmic','#Linear');
            SingleActiveButtonCheckNoBool('#Logarithmic','#Quadratic');
            SingleActiveButtonCheckNoBool('#Logarithmic','#Cubic');
            SingleActiveButtonCheckNoBool('#Logarithmic','#PowerLaw');
            SingleActiveButtonCheckNoBool('#Logarithmic','#Exponential');

      });



	    var oldVal = "";
        $("#inputTextAreaData").on("change keyup paste", function()
        {
            var currentVal = $(this).val();
            if(currentVal == oldVal)
            {
                return; //check to prevent multiple simultaneous triggers
            }

            oldVal = currentVal;
            //action to be performed on textarea changed
            type();
        });

    };

    $(document).ready(main);

</script>
